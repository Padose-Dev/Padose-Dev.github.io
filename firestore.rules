rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Seller enquiries: allow create with validation, allow list for count queries
    match /seller-enquiries/{enquiryId} {
      allow create: if request.resource.data.keys().hasAll([
        'businessName', 'email', 'contactNumber', 'status', 'createdAt'
      ])
      && request.resource.data.status == 'new'
      && request.resource.data.businessName is string
      && request.resource.data.businessName.size() >= 3
      && request.resource.data.businessName.size() <= 200
      && request.resource.data.email is string
      && request.resource.data.email.size() <= 254
      && request.resource.data.contactNumber is string
      && request.resource.data.contactNumber.size() <= 15
      && request.resource.data.keys().size() <= 15;

      // Allow list (needed for count aggregation), deny individual doc get
      allow list: if true;
      allow get: if false;
      allow update, delete: if false;
    }

    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
